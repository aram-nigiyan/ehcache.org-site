<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Components and Concepts</title><link rel="Prev" href="co-abt_what_is_the_web_caching_module.html" title="Previous"><link rel="Next" href="to-use_using_web_cache_module.html" title="Next"><link rel="StyleSheet" href="css/ehcache_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/ehcache_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pqN73gyYlQ0mtUY1Fj_002b_002f1OA" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/Ehcache_Documentation_Set/co-abt_components_and_concepts.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/ehcache_all.1.188.html#wwconnect_header">Related Documentation</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/ehcache_all.1.219.html#wwconnect_header">Web Cache User Guide</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/to-abt_about_the_web_cache_module.html#wwconnect_header">About the Web Cache Module</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Components and Concepts</span></div><div class="ww_skin_page_toolbar"><!-- Twitter --><!--         --><!-- FaceBook Like --><!--               --><!-- LinkedIn Share --><!--                --><!-- Google +1 --><!--           --><!--        <a wwpage:condition="print-enabled" class="ww_behavior_print ww_skin ww_skin_print" title="Print" wwpage:attribute-title="navigation-print-title" href="#">&#160;</a>  --></div></header><div id="ww3_12_4_5_8_1" class="Heading_3">Components and Concepts</div><div id="ww3_12_4_5_8_2_2_3" class="Section_Title">SimplePageCachingFilter</div><div id="ww3_12_4_5_8_2_2_5" class="Body">The SimplePageCachingFilter is a simple caching filter suitable for caching compressible HTTP responses such as HTML, XML or JSON. It uses a singleton CacheManager created with the default factory method. Override to use a different CacheManager.</div><div id="ww3_12_4_5_8_2_2_7" class="Body">It is suitable for:</div><div id="ww3_12_4_5_8_2_2_9_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>complete responses (i.e. not fragments).</div><div id="ww3_12_4_5_8_2_2_9_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>A content type suitable for gzipping. For example, text or text/html.</div><div id="ww3_12_4_5_8_2_2_11" class="Body">For fragments see <span class="xref"><a href="../Ehcache_Documentation_Set/co-abt_components_and_concepts.html#ww3_12_4_5_8_2_18_3" title="Components and Concepts">SimplePageFragmentCachingFilter</a></span>.</div><div id="ww3_12_4_5_8_2_4_3" class="Section_Title">Keys</div><div id="ww3_12_4_5_8_2_4_5" class="Body">Pages are cached based on their key. The key for this cache is the URI followed by the query string. An example is <span class="codeph">/admin/SomePage.jsp?id=1234&amp;name=Beagle</span>. This key technique is suitable for a wide range of uses. It is independent of host name and port number, so will work well in situations where there are multiple domains which get the same content, or where users access based on different port numbers. A problem can occur with tracking software, where unique ids are inserted into request query strings. Because each request generates a unique key, there will never be a cache hit. For these situations it is better to parse the request parameters and override <span class="codeph">calculateKey(javax.servlet.http.HttpServletRequest)</span> with an implementation that takes account of only the significant ones.</div><div id="ww3_12_4_5_8_2_6_3" class="Section_Title">Configuring the Cache Name</div><div id="ww3_12_4_5_8_2_6_5" class="Body">A cache entry in ehcache.xml should be configured with the name of the filter. Names can be set using the init-param <span class="codeph">cacheName</span>, or by sub-classing this class and overriding the name.</div><div id="ww3_12_4_5_8_2_8_3" class="Section_Title">Concurrent Cache Misses</div><div id="ww3_12_4_5_8_2_8_5" class="Body">A cache miss will cause the filter chain, upstream of the caching filter to be processed. To avoid threads requesting the same key to do useless duplicate work, these threads block behind the first thread. The thread timeout can be set to fail after a certain wait by setting the init-param <span class="codeph">blockingTimeoutMillis</span>. By default threads wait indefinitely. In the event upstream processing never returns, eventually the web server may get overwhelmed with connections it has not responded to. By setting a timeout, the waiting threads will only block for the set time, and then throw a net.sf.ehcache.constructs.blocking.LockTimeoutException. Under either scenario an upstream failure will still cause a failure.</div><div id="ww3_12_4_5_8_2_10_3" class="Section_Title">Gzipping</div><div id="ww3_12_4_5_8_2_10_5" class="Body">Significant network efficiencies, and page loading speedups, can be gained by gzipping responses. Whether a response can be gzipped depends on:</div><div id="ww3_12_4_5_8_2_10_7_2_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Whether the user agent can accept GZIP encoding. This feature is part of HTTP1.1.</div><div id="ww3_12_4_5_8_2_10_7_2-4" class="List_1_Continued">If a browser accepts GZIP encoding it will advertise this by including in its HTTP header: All common browsers except IE 5.2 on Macintosh are capable of accepting gzip encoding. Most search engine robots do not accept gzip encoding.</div><div id="ww3_12_4_5_8_2_10_7_4_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Whether the user agent has advertised its acceptance of gzip encoding. This is on a per request basis. If they will accept a gzip response to their request they must include the following in the HTTP request header:</div><div id="ww3_12_4_5_8_2_10_7_4_6" class="Preformatted_1">Accept-Encoding: gzip</div><div id="ww3_12_4_5_8_2_10_9" class="Body">Responses are automatically gzipped and stored that way in the cache. For requests which do not accept gzip encoding the page is retrieved from the cache, ungzipped and returned to the user agent. The ungzipping is high performance.</div><div id="ww3_12_4_5_8_2_12_3" class="Section_Title">Caching Headers</div><div id="ww3_12_4_5_8_2_12_5" class="Body">The <span class="codeph">SimpleCachingHeadersPageCachingFilter</span> extends <span class="codeph">SimplePageCachingFilter</span> to provide the HTTP cache headers: ETag, Last-Modified and Expires. It supports conditional GET. Because browsers and other HTTP clients have the expiry information returned in the response headers, they do not even need to request the page again. Even once the local browser copy has expired, the browser will do a conditional GET. So why would you ever want to use SimplePageCachingFilter, which does not set these headers?</div><div id="ww3_12_4_5_8_2_12_7" class="Body">The answer is that in some caching scenarios you may wish to remove a page before its natural expiry. Consider a scenario where a web page shows dynamic data. Under Ehcache the Element can be removed at any time. However if a browser is holding expiry information, those browsers will have to wait until the expiry time before getting updated. The caching in this scenario is more about defraying server load rather than minimizing browser calls.</div><div id="ww3_12_4_5_8_2_14_3" class="Section_Title">Init-Params</div><div id="ww3_12_4_5_8_2_14_5" class="Body">The following init-params are supported:</div><div id="ww3_12_4_5_8_2_14_7_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="codeph">cacheName</span> - the name in ehcache.xml used by the filter.</div><div id="ww3_12_4_5_8_2_14_7_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="codeph">blockingTimeoutMillis</span> - the time, in milliseconds, to wait for the filter chain to return with a response on a cache miss. This is useful to fail fast in the event of an infrastructure failure.</div><div id="ww3_12_4_5_8_2_14_7_6_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="codeph">varyHeader</span> - set to true to set Vary:Accept-Encoding in the response when doing Gzip. This header is needed to support HTTP proxies however it is off by default.</div><div id="ww3_12_4_5_8_2_14_7_6_6" class="Preformatted_1">&lt;init-param&gt;<br>  &lt;param-name&gt;varyHeader&lt;/param-name&gt;<br>  &lt;param-value&gt;true&lt;/param-value&gt;<br>&lt;/init-param&gt;<br></div><div id="ww3_12_4_5_8_2_16_3" class="Section_Title">Re-entrance</div><div id="ww3_12_4_5_8_2_16_5" class="Body">Care should be taken not to define a filter chain such that the same <span class="codeph">CachingFilter</span> class is reentered. The <span class="codeph">CachingFilter</span> uses the <span class="codeph">BlockingCache</span>. It blocks until the thread which did a get which results in a null does a put. If reentry happens a second get happens before the first put. The second get could wait indefinitely. This situation is monitored and if it happens, an IllegalStateException will be thrown.</div><div id="ww3_12_4_5_8_2_18_3" class="Section_Title">SimplePageFragmentCachingFilter</div><div id="ww3_12_4_5_8_2_18_5" class="Body">The SimplePageFragmentCachingFilter does everything that SimplePageCachingFilter does, except it never gzips, so the fragments can be combined. There is a variant of this filter which sets browser caching headers, because that is only applicable to the entire page.</div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright © <span>2014</span><span> </span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/product_online.png" alt="Product Logo"><!--	     <a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank" >Contact&#160;Support</a> --><!--         &#160;&#160;|&#160;&#160;  --><!--         <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank" >Community</a>  --><!--         &#160;&#160;  -->
             |&nbsp;&nbsp;
         <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></div></body></html>